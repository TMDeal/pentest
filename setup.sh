#!/bin/bash

git submodule update --init --recursive

#####################################

echo "Setting up BloodHound"
echo -e "================\n\n"

cd BloodHound
../scripts/download_github_release "BloodHoundAD/BloodHound" linux-x64

unzip BloodHound-linux-x64.zip 1> /dev/null
mv BloodHound-linux-x64 BloodHound
rm BloodHound-linux-x64.zip
chmod +x BloodHound/BloodHound

../scripts/download_github_release "BloodHoundAD/SharpHound" -v debug

unzip *.zip -d SharpHound 1> /dev/null
rm *.zip

ln -sf ../BloodHound/BloodHound/BloodHound ../bin/bloodhound

cd ..

echo -e "\n\nBloodHound setup complete"
echo -e "===================\n\n"

#####################################

#####################################

echo "Setting up CeWL"
echo -e "================\n\n"

cd CeWL
bundle install
sudo apt-get install libimage-exiftool-perl -y

ln -sf ../CeWL/cewl.rb ../bin/cewl

cd ..

echo -e "\n\nCeWL setup complete"
echo -e "===================\n\n"

#####################################

#####################################

echo "Setting up Ghidra"
echo -e "================\n\n"

cd ghidra

../scripts/download_github_release "NationalSecurityAgency/ghidra"

unzip *.zip 2>&1 1>/dev/null
ghidraDir=$(ls -l | awk 'NR==2{print $NF}')
rm *.zip

ln -sf ../ghidra/$ghidraDir/ghidraRun ../bin/ghidra

cd ..

echo -e "\n\nGhidra setup complete"
echo -e "===================\n\n"

#####################################


#####################################

echo "Setting up GreatSCT"
echo -e "================\n\n"

cd GreatSCT/setup
sudo ./setup.sh -c

cd ..

ln -sf ../GreatSCT/GreatSCT.py ../bin/GreatSCT
find . | grep -E "(__pycache__|\.pyc|\.pyo$)" | xargs rm -rf

cd ..

echo -e "\n\nGreatSCT setup complete"
echo -e "===================\n\n"

#####################################

echo "Setting up kerbrute"
echo -e "================\n\n"

cd kerbrute
../scripts/download_github_release "ropnop/kerbrute"

kerbrute_binary="kerbrute_linux_amd64"
chmod +x ./kerbrute_linux_amd64
ln -sf ../kerbrute/kerbrute_linux_amd64 ../bin/kerbrute

cd ..


echo -e "\n\nkerbrute setup complete"
echo -e "===================\n\n"

#####################################

echo "Setting up PEASS"
echo -e "================\n\n"

cd PEASS
../scripts/download_github_release "carlospolop/PEASS-ng"

cd ..

echo -e "\n\nPEASS setup complete"
echo -e "===================\n\n"

#####################################

echo "Setting up scripts"
echo -e "================\n\n"

cd scripts
ln -sf ../scripts/smbver ../bin/smbver
ln -sf ../scripts/tightvnc_decrypt ../bin/tightvnc_decrypt
ln -sf ../scripts/wesng ../bin/wesng
ln -sf ../scripts/pret ../bin/pret

cd ..

echo -e "\n\nscripts setup complete"
echo -e "===================\n\n"

#####################################

echo -e "\n\nSetup Complete!"
